<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Flipper Zero Firmware: Flipper Build Tool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Flipper Zero Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Flipper Build Tool </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >FBT is the entry point for firmware-related commands and utilities. It is invoked by <code>./fbt</code> in the firmware project root directory. Internally, it is a wrapper around <a href="https://scons.org/">scons</a> build system.</p>
<p >If you don't need all features of <code>fbt</code> - like building the whole firmware - and only want to build and debug a single application, you can use <a href="https://pypi.org/project/ufbt/">ufbt</a>.</p>
<h1><a class="anchor" id="autotoc_md42"></a>
Environment</h1>
<p >To use <code>fbt</code>, you only need <code>git</code> installed in your system.</p>
<p ><code>fbt</code> by default downloads and unpacks a pre-built toolchain, and then modifies environment variables for itself to use it. It does not contaminate your global system's path with the toolchain. </p><blockquote class="doxtable">
<p >However, if you wish to use tools supplied with the toolchain outside <code>fbt</code>, you can open an <em>fbt shell</em>, with properly configured environment.</p><ul>
<li>On Windows, simply run <code>scripts/toolchain/fbtenv.cmd</code>.</li>
<li>On Linux &amp; MacOS, run <code>source scripts/toolchain/fbtenv.sh</code> in a new shell. </li>
</ul>
</blockquote>
<p>If your system is not supported by pre-built toolchain variants or you want to use custom versions of dependencies, you can <code>set FBT_NOENV=1</code>. <code>fbt</code> will skip toolchain &amp; environment configuration and will expect all tools to be available on your system's <code>PATH</code>. *(this option is not available on Windows)*</p>
<p >If <code>FBT_TOOLCHAIN_PATH</code> variable is set, <code>fbt</code> will use that directory to unpack toolchain into. By default, it downloads toolchain into <code>toolchain</code> subdirectory repo's root.</p>
<p >If you want to enable extra debug output for <code>fbt</code> and toolchain management scripts, you can <code>set FBT_VERBOSE=1</code>.</p>
<p ><code>fbt</code> always performs <code>git submodule update --init</code> on start, unless you set <code>FBT_NO_SYNC=1</code> in the environment:</p><ul>
<li>On Windows, it's <code>set "FBT_NO_SYNC=1"</code> in the shell you're running <code>fbt</code> from</li>
<li>On *nix, it's <code>$ FBT_NO_SYNC=1 ./fbt ...</code></li>
</ul>
<blockquote class="doxtable">
<p >There are more variables controlling basic <code>fbt</code> behavior. See <code>fbt</code> &amp; <code>fbtenv</code> scripts' sources for details. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md43"></a>
Invoking FBT</h1>
<p >To build with FBT, call it and specify configuration options &amp; targets to build. For example:</p>
<p ><code>./fbt COMPACT=1 DEBUG=0 VERBOSE=1 updater_package copro_dist</code></p>
<p >To run cleanup (think of <code>make clean</code>) for specified targets, add the <code>-c</code> option.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Build directories</h1>
<p ><code>fbt</code> builds updater &amp; firmware in separate subdirectories in <code>build</code>, and their names depend on optimization settings (<code>COMPACT</code> &amp; <code>DEBUG</code> options). However, for ease of integration with IDEs, the latest built variant's directory is always linked as <code>built/latest</code>. Additionally, <code>compile_commands.json</code> is generated in that folder (it is used for code completion support in IDEs).</p>
<p ><code>build/latest</code> symlink &amp; compilation database are only updated upon <em>firmware build targets</em> - that is, when you're re-building the firmware itself. Running other tasks, like firmware flashing or building update bundles <em>for a different debug/release configuration or hardware target</em>, does not update <code>built/latest</code> dir to point to that configuration.</p>
<h1><a class="anchor" id="autotoc_md45"></a>
VSCode integration</h1>
<p ><code>fbt</code> includes basic development environment configuration for VS Code. Run <code>./fbt vscode_dist</code> to deploy it. That will copy the initial environment configuration to the <code>.vscode</code> folder. After that, you can use that configuration by starting VS Code and choosing the firmware root folder in the "File &gt; Open Folder" menu.</p>
<ul>
<li>On the first start, you'll be prompted to install recommended plugins. We highly recommend installing them for the best development experience. <em>You can find a list of them in <code>.vscode/extensions.json</code>.</em></li>
<li>Basic build tasks are invoked in the Ctrl+Shift+B menu.</li>
<li>Debugging requires a supported probe. That includes:<ul>
<li>Wi-Fi devboard with stock firmware (blackmagic).</li>
<li>ST-Link and compatible devices.</li>
<li>J-Link for flashing and debugging (in VSCode only). <em>Note that J-Link tools are not included with our toolchain and you have to <a href="https://www.segger.com/downloads/jlink/">download</a> them yourself and put them on your system's PATH.</em></li>
</ul>
</li>
<li>Without a supported probe, you can install firmware on Flipper using the USB installation method.</li>
</ul>
<h1><a class="anchor" id="autotoc_md46"></a>
FBT targets</h1>
<p ><code>fbt</code> keeps track of internal dependencies, so you only need to build the highest-level target you need, and <code>fbt</code> will make sure everything they depend on is up-to-date.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
High-level (what you most likely need)</h2>
<ul>
<li><code>fw_dist</code> - build &amp; publish firmware to the <code>dist</code> folder. This is a default target when no others are specified.</li>
<li><code>fap_dist</code> - build external plugins &amp; publish to the <code>dist</code> folder.</li>
<li><code>updater_package</code>, <code>updater_minpackage</code> - build a self-update package. The minimal version only includes the firmware's DFU file; the full version also includes a radio stack &amp; resources for the SD card.</li>
<li><code>copro_dist</code> - bundle Core2 FUS+stack binaries for qFlipper.</li>
<li><code>flash</code> - flash the attached device with OpenOCD over ST-Link.</li>
<li><code>flash_usb</code>, <code>flash_usb_full</code> - build, upload and install the update package to the device over USB. See details on <code>updater_package</code> and <code>updater_minpackage</code>.</li>
<li><code>debug</code> - build and flash firmware, then attach with gdb with firmware's .elf loaded.</li>
<li><code>debug_other</code>, <code>debug_other_blackmagic</code> - attach GDB without loading any <code>.elf</code>. It will allow you to manually add external <code>.elf</code> files with <code>add-symbol-file</code> in GDB.</li>
<li><code>updater_debug</code> - attach GDB with the updater's <code>.elf</code> loaded.</li>
<li><code>blackmagic</code> - debug firmware with Blackmagic probe (WiFi dev board).</li>
<li><code>openocd</code> - just start OpenOCD.</li>
<li><code>get_blackmagic</code> - output the blackmagic address in the GDB remote format. Useful for IDE integration.</li>
<li><code>get_stlink</code> - output serial numbers for attached STLink probes. Used for specifying an adapter with <code>OPENOCD_ADAPTER_SERIAL=...</code>.</li>
<li><code>lint</code>, <code>format</code> - run clang-format on the C source code to check and reformat it according to the <code>.clang-format</code> specs.</li>
<li><code>lint_py</code>, <code>format_py</code> - run <a href="https://black.readthedocs.io/en/stable/index.html">black</a> on the Python source code, build system files &amp; application manifests.</li>
<li><code>firmware_pvs</code> - generate a PVS Studio report for the firmware. Requires PVS Studio to be available on your system's <code>PATH</code>.</li>
<li><code>cli</code> - start a Flipper CLI session over USB.</li>
</ul>
<h2><a class="anchor" id="autotoc_md48"></a>
Firmware targets</h2>
<ul>
<li><code>faps</code> - build all external &amp; plugin apps as <a href="./AppsOnSDCard.md#fap-flipper-application-package"><code>.faps</code></a>.</li>
<li><code>fbt</code> also defines per-app targets. For example, for an app with <code>appid=snake_game</code> target names are:<ul>
<li><code>fap_snake_game</code>, etc. - build single app as <code>.fap</code> by its application ID.</li>
<li>Check out <a href="#command-line-parameters"><code>--extra-ext-apps</code></a> for force adding extra apps to external build.</li>
<li><code>fap_snake_game_list</code>, etc - generate source + assembler listing for app's <code>.fap</code>.</li>
</ul>
</li>
<li><code>flash</code>, <code>firmware_flash</code> - flash the current version to the attached device with OpenOCD over ST-Link.</li>
<li><code>jflash</code> - flash the current version to the attached device with JFlash using a J-Link probe. The JFlash executable must be on your <code>$PATH</code>.</li>
<li><code>flash_blackmagic</code> - flash the current version to the attached device with a Blackmagic probe.</li>
<li><code>firmware_all</code>, <code>updater_all</code> - build a basic set of binaries.</li>
<li><code>firmware_list</code>, <code>updater_list</code> - generate source + assembler listing.</li>
<li><code>firmware_cdb</code>, <code>updater_cdb</code> - generate a <code>compilation_database.json</code> file for external tools and IDEs. It can be created without actually building the firmware.</li>
</ul>
<h2><a class="anchor" id="autotoc_md49"></a>
Assets</h2>
<ul>
<li><code>resources</code> - build resources and their manifest files<ul>
<li><code>dolphin_ext</code> - process dolphin animations for the SD card</li>
</ul>
</li>
<li><code>icons</code> - generate <code>.c+.h</code> for icons from PNG assets</li>
<li><code>proto</code> - generate <code>.pb.c+.pb.h</code> for <code>.proto</code> sources</li>
<li><code>proto_ver</code> - generate <code>.h</code> with a protobuf version</li>
<li><code>dolphin_internal</code>, <code>dolphin_blocking</code> - generate <code>.c+.h</code> for corresponding dolphin assets</li>
</ul>
<h1><a class="anchor" id="autotoc_md50"></a>
Command-line parameters</h1>
<ul>
<li><code>--options optionfile.py</code> (default value <code>fbt_options.py</code>) - load a file with multiple configuration values</li>
<li><code>--extra-int-apps=app1,app2,appN</code> - force listed apps to be built as internal with the <code>firmware</code> target</li>
<li><code>--extra-ext-apps=app1,app2,appN</code> - force listed apps to be built as external with the <code>firmware_extapps</code> target</li>
<li><code>--extra-define=A --extra-define=B=C</code> - extra global defines that will be passed to the C/C++ compiler, can be specified multiple times</li>
<li><code>--proxy-env=VAR1,VAR2</code> - additional environment variables to expose to subprocesses spawned by <code>fbt</code>. By default, <code>fbt</code> sanitizes the execution environment and doesn't forward all inherited environment variables. You can find the list of variables that are always forwarded in the <code>environ.scons</code> file.</li>
</ul>
<h1><a class="anchor" id="autotoc_md51"></a>
Configuration</h1>
<p >Default configuration variables are set in the configuration file: <code>fbt_options.py</code>. Values set in the command line have higher precedence over the configuration file.</p>
<p >You can find out available options with <code>./fbt -h</code>.</p>
<h2><a class="anchor" id="autotoc_md52"></a>
Firmware application set</h2>
<p >You can create customized firmware builds by modifying the list of applications to be included in the build. Application presets are configured with the <code>FIRMWARE_APPS</code> option, which is a <code>map(configuration_name:str -&gt; application_list:tuple(str))</code>. To specify an application set to use in the build, set <code>FIRMWARE_APP_SET</code> to its name. For example, to build a firmware image with unit tests, run <code>./fbt FIRMWARE_APP_SET=unit_tests</code>.</p>
<p >Check out <code>fbt_options.py</code> for details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
